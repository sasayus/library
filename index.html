<html lang="ko" style="--accent: #b71c1c;"><head>
    <meta charset="UTF-8">
    <title>ì‘ê°€ ì²œê°(å¤©åˆ»)ì˜ ì„¸ê³„ê´€ ì´ì•¼ê¸° ë³´ë”°ë¦¬</title>
    <style>
        :root { 
            --bg: #f5f5f7; --card: #ffffff; --sidebar: #ffffff;
            --text: #1d1d1f; --sub-text: #86868b;
            --accent: #1d1d1f; 
            --gold: #ffcc00; --border: #e5e5e7; 
            --monster-red: #d70015; --shadow: rgba(0,0,0,0.05);
            --danger-glow: none;
        }
        body.dark-mode {
            --bg: #1c1c1e; --card: #2c2c2e; --sidebar: #2c2c2e;
            --text: #f5f5f7; --sub-text: #a1a1a6;
            --border: #3a3a3c; --shadow: rgba(0,0,0,0.3);
            --monster-red: #ff453a;
            --danger-glow: 0 0 10px rgba(255, 69, 58, 0.5);
        }
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); color: var(--text); display: flex; margin: 0; height: 100vh; overflow: hidden; transition: 0.3s; }
        
        /* ë…ì ëª¨ë“œ UI ì€í */
        body.reader-mode .nav-btns, body.reader-mode .btn-delete, body.reader-mode .author-note, body.reader-mode .edit-only, body.reader-mode .update-info, body.reader-mode .theme-setter { display: none !important; }
        body.reader-mode [contenteditable="true"] { pointer-events: none; cursor: default; }

        nav { width: 300px; background: var(--sidebar); border-right: 1px solid var(--border); padding: 25px 15px; overflow-y: auto; display: flex; flex-direction: column; }
        nav h2 { color: var(--text); font-size: 1rem; border-bottom: 2px solid var(--text); padding-bottom: 15px; margin-bottom: 20px; text-align: center; font-weight: 700; cursor: pointer; }
        .novel-selector { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--border); margin-bottom: 10px; font-weight: 600; font-family: inherit; cursor: pointer; background: var(--card); color: var(--text); border-left: 5px solid var(--accent); }
        .search-bar { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--border); margin-bottom: 20px; box-sizing: border-box; font-size: 0.85rem; background: var(--bg); color: var(--text); }

        /* í”„ë¦¬ì…‹ ë²„íŠ¼ */
        .preset-group { display: flex; gap: 5px; margin-bottom: 20px; justify-content: space-between; }
        .btn-preset { width: 18%; height: 25px; border-radius: 4px; border: 1px solid var(--border); cursor: pointer; transition: 0.2s; }
        .btn-preset:hover { transform: scale(1.1); }

        #sidebar-menu { flex: 1; overflow-y: auto; margin-bottom: 20px; }
        .side-cat { font-size: 0.75rem; color: var(--accent); font-weight: 800; margin-top: 20px; margin-bottom: 8px; text-transform: uppercase; border-bottom: 1px solid var(--border); padding-bottom: 4px; }
        .side-sub { font-size: 0.8rem; color: var(--sub-text); margin: 10px 0 5px 5px; font-weight: 700; border-left: 2px solid var(--border); padding-left: 8px; }
        .side-item { font-size: 0.85rem; padding: 8px 12px; cursor: pointer; border-radius: 6px; color: var(--text); margin-bottom: 2px; transition: 0.2s; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; opacity: 0.8; }
        .side-item:hover { background: var(--bg); opacity: 1; }
        .side-item.active { background: var(--accent); color: #fff; font-weight: 700; opacity: 1; }
        
        .nav-btns { display: flex; flex-direction: column; gap: 8px; border-top: 1px solid var(--border); padding-top: 15px; }
        .btn-action { background: var(--card); border: 1px solid var(--border); color: var(--text); padding: 10px; cursor: pointer; border-radius: 8px; font-size: 0.75rem; transition: 0.2s; font-weight: 500; }
        .btn-action:hover { border-color: var(--accent); background: var(--bg); }
        .update-info { font-size: 0.65rem; color: var(--sub-text); margin-top: 10px; text-align: center; }

        main { flex: 1; display: flex; flex-direction: column; background: var(--bg); position: relative; }
        #page-container { flex: 1; overflow-y: auto; padding: 40px; display: flex; justify-content: center; }
        #content { width: 100%; max-width: 800px; animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .wiki-card { background: var(--card); padding: 60px; border-radius: 4px; border: 1px solid var(--border); box-shadow: 0 10px 30px var(--shadow); min-height: 700px; position: relative; border-top: 8px solid var(--accent); transition: 0.3s; }
        .high-danger { border-top: 8px solid var(--monster-red); background: rgba(215, 0, 21, 0.02); }
        .high-danger h1, .high-danger .editable-area, .high-danger .info-val { color: var(--monster-red) !important; text-shadow: var(--danger-glow); }

        .page-footer { height: 60px; border-top: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 40px; background: var(--card); }
        .page-num-display { font-weight: 700; font-size: 0.9rem; color: var(--sub-text); }

        h1 { font-size: 2.5rem; margin: 0 0 20px 0; outline: none; font-weight: 800; color: var(--text); }
        .danger-zone { margin-bottom: 25px; color: var(--gold); cursor: pointer; font-size: 1.2rem; background: var(--bg); display: inline-block; padding: 5px 15px; border-radius: 30px; border: 1px solid var(--border); transition: 0.2s; }
        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 30px 0; border-top: 1px solid var(--border); border-bottom: 1px solid var(--border); padding: 25px 0; }
        .info-label { font-size: 0.75rem; color: var(--accent); font-weight: 800; text-transform: uppercase; margin-bottom: 5px; }
        .info-val { font-size: 1rem; outline: none; }
        .editable-area { line-height: 2; font-size: 1.15rem; color: var(--text); outline: none; min-height: 200px; white-space: pre-wrap; }
        .author-note { margin-top: 40px; padding: 25px; background: var(--bg); border-radius: 12px; border: 1px dashed var(--accent); opacity: 0.7; }
    </style>
</head>
<body class="">
<nav id="sidebar">
    <h2 onclick="location.reload()">ì²œê°(å¤©åˆ») ì„¸ê³„ê´€ ë„ê°</h2>
    <button class="btn-action" onclick="toggleDarkMode()" style="margin-bottom:15px;">ğŸŒ™ ë‹¤í¬ ëª¨ë“œ ì „í™˜</button>
    <select id="novel-filter" class="novel-selector" onchange="changeNovel(this.value)"><option value="all">ì „ì²´ ì‘í’ˆ ë³´ê¸°</option><option value="ê¸°ì¡´ ì†Œì„¤">ê¸°ì¡´ ì†Œì„¤</option><option value="ì‚´ê¸° ë±€íŒŒ">ì‚´ê¸° ë±€íŒŒ</option></select>
    
    <div class="edit-only theme-setter" style="margin-bottom:5px; font-size:0.75rem; font-weight:800; color:var(--sub-text);">í…Œë§ˆ í”„ë¦¬ì…‹</div>
    <div class="preset-group edit-only">
        <div class="btn-preset" style="background:#1d1d1f;" onclick="updateThemeColor('#1d1d1f')" title="Classic Ink"></div>
        <div class="btn-preset" style="background:#1a237e;" onclick="updateThemeColor('#1a237e')" title="Midnight Blue"></div>
        <div class="btn-preset" style="background:#b71c1c;" onclick="updateThemeColor('#b71c1c')" title="Crimson Red"></div>
        <div class="btn-preset" style="background:#1b5e20;" onclick="updateThemeColor('#1b5e20')" title="Forest Green"></div>
        <div class="btn-preset" style="background:#bf9000;" onclick="updateThemeColor('#bf9000')" title="Royal Gold"></div>
    </div>
    
    <input type="text" id="search-input" class="search-bar" placeholder="ì„¤ì • ê²€ìƒ‰..." oninput="renderSidebar()">
    <div id="sidebar-menu"><div class="side-cat" style="color: var(--accent);">0. ì„¸ê³„ê´€</div><div class="side-item">ìƒˆ í•­ëª©</div><div class="side-cat" style="color: var(--accent);">1. ìºë¦­í„°</div><div class="side-item">ë¡œì¸ ì¹´ë°€ë£¨ìŠ¤&nbsp;</div><div class="side-item">ë¡œì¸ ì¹´ë°€ë£¨ìŠ¤&nbsp;</div><div class="side-cat" style="color: var(--accent);">2. ëª¬ìŠ¤í„°</div><div class="side-item">ìŠ¤ì¼ˆë ˆí†¤</div><div class="side-cat" style="color: var(--accent);">3. ì§œíˆ¬ë¦¬</div><div class="side-item">ìƒˆë¡œìš´ ì´ì•¼ê¸°</div></div>
    <div class="nav-btns">
        <button class="btn-action" onclick="addNewItem()">ìƒˆë¡œìš´ ì´ì•¼ê¸°ë¥¼ ì ì–´ë‚˜ê°„ë‹¤</button>
        <button class="btn-action" onclick="copyFullCode()">ì „ì²´ ì†ŒìŠ¤ ì½”ë“œ ë³µì‚¬</button>
        <button class="btn-action" onclick="exportData()" style="background: #f0f0f5; border-color: var(--border);">ë°ì´í„° ë°±ì—… ë‹¤ìš´ë¡œë“œ</button>
        <button class="btn-action" onclick="copyReaderLink()" style="border-color:#2196F3; color:#2196F3;">ë…ììš© ë§í¬ ë³µì‚¬</button>
        <div id="last-update-display" class="update-info">ë§ˆì§€ë§‰ ë³µì‚¬: 2026. 1. 22. ì˜¤í›„ 10:17:26</div>
    </div>
</nav>
<main>
    <div id="page-container"><div id="content"><div class="wiki-card" style="display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center;"><div style="font-size:4rem; font-weight:800; letter-spacing:15px; color:var(--accent)">å¤© åˆ»</div><p style="margin-top:20px; color:var(--sub-text);">í†µí•© ë„ê°</p></div></div></div>
    <div class="page-footer">
        <div class="page-nav" style="display:flex; gap:10px;"><button class="btn-action" onclick="prevPage()">ì´ì „</button><button class="btn-action" onclick="nextPage()">ë‹¤ìŒ</button></div>
        <div class="page-num-display" id="footer-page-num">PAGE 1</div>
        <div class="jump-box" style="display:flex; gap:5px; align-items:center;"><input type="number" id="jump-page-input" style="width:40px; border-radius:4px; border:1px solid var(--border); background:var(--bg); color:var(--text); text-align:center;"><button class="btn-action" onclick="jumpToPage()">ì´ë™</button></div>
    </div>
</main>
<script>
    const categories = ["0. ì„¸ê³„ê´€", "1. ìºë¦­í„°", "2. ëª¬ìŠ¤í„°", "3. ì§œíˆ¬ë¦¬", "4. ê´€ê³„ë„", "5. ì—°ëŒ€ê¸°"];
    let wikiData = [
    {
        "type": 2,
        "title": "ìŠ¤ì¼ˆë ˆí†¤",
        "danger": 9,
        "habitat": "ã…",
        "weakness": "ìƒì „ì˜ ì›í•œ í•´ì†Œ",
        "content": "ë¼ˆë¡œ ì´ë£¨ì–´ì§„ ë§ìì…ë‹ˆë‹¤. ì›í•œì˜ í•´ì†Œë§Œ í•  ìˆ˜ ìˆìœ¼ë©´ ì–´ë¦° ì•„ì´ë„ ìƒëŒ€ê°€ ê°€ëŠ¥í•˜ë‹¤.",
        "authorMemo": "ì´ˆë°˜ ëª¬ìŠ¤í„°",
        "novel": "ê¸°ì¡´ ì†Œì„¤"
    },
    {
        "type": 1,
        "subCategory": "ì£¼ì—°",
        "title": "ë¡œì¸ ì¹´ë°€ë£¨ìŠ¤Â ",
        "content": "ì£¼ì¸ê³µ ì´ì „ì˜ ì§„ì§œ ë¡œì¸ ì¹´ë°€ë£¨ìŠ¤. \n\n",
        "danger": 5,
        "habitat": "ëª°ë½ ê·€ì¡±",
        "weakness": "ì„±ìˆ˜",
        "testimony": "ê·¸ ë³„ë³¼ì¼ ì—†ëŠ” ë±€íŒŒì´ì–´?",
        "authorMemo": "",
        "novel": "ê¸°ì¡´ ì†Œì„¤"
    },
    {
        "type": 3,
        "subCategory": "ë¯¸ë¶„ë¥˜",
        "title": "ìƒˆë¡œìš´ ì´ì•¼ê¸°",
        "content": "ë‚´ìš© ì…ë ¥ã„´",
        "danger": 1,
        "habitat": "",
        "weakness": "",
        "testimony": "",
        "authorMemo": "",
        "novel": "ê¸°ì¡´ ì†Œì„¤"
    },
    {
        "novel": "ì‚´ê¸° ë±€íŒŒ",
        "type": 0,
        "subCategory": "ë¯¸ë¶„ë¥˜",
        "title": "ìƒˆ í•­ëª©",
        "content": "ë‚´ìš© ì…ë ¥",
        "danger": 1,
        "habitat": "ã„´",
        "weakness": "",
        "authorMemo": ""
    },
    {
        "novel": "ì‚´ê¸° ë±€íŒŒ",
        "type": 1,
        "subCategory": "ë¯¸ë¶„ë¥˜",
        "title": "ë¡œì¸ ì¹´ë°€ë£¨ìŠ¤Â ",
        "content": "ë‚´ìš© ì…ë ¥",
        "danger": 1,
        "habitat": "",
        "weakness": "",
        "authorMemo": ""
    }
];
    let novelThemes = {
    "ê¸°ë³¸ ì„¤ì •": "#ff3b30",
    "ì‚´ê¸° ë±€íŒŒ": "#ff3b30",
    "all": "#b71c1c"
};
    let darkMode = false;
    let lastUpdated = "2026. 1. 22. ì˜¤í›„ 10:25:49";

    // ë°ì´í„° ë¡œë“œ
    const newSaved = localStorage.getItem('chunGakData_v9');
    const savedThemes = localStorage.getItem('chunGakThemes_v9');
    const savedDark = localStorage.getItem('chunGakDark');
    const savedTime = localStorage.getItem('chunGakTime');
    if (newSaved) wikiData = JSON.parse(newSaved);
    if (savedThemes) novelThemes = JSON.parse(savedThemes);
    if (savedTime) lastUpdated = savedTime;
    if (savedDark === 'true') { darkMode = true; document.body.classList.add('dark-mode'); }

    const isReader = new URLSearchParams(window.location.search).get('mode') === 'read';
    if (isReader) document.body.classList.add('reader-mode');

    window.addEventListener('beforeunload', function (e) {
        if (!isReader) { e.preventDefault(); e.returnValue = ''; }
    });

    let currentNovelFilter = "all";
    let currentPage = 1;
    let totalPages = 2;

    function toggleDarkMode() { darkMode = !darkMode; document.body.classList.toggle('dark-mode'); localStorage.setItem('chunGakDark', darkMode); renderPage(); }
    
    // í…Œë§ˆ ì ìš© í•¨ìˆ˜ ë³´ê°•
    function applyTheme(color) {
        const themeColor = color || '#1d1d1f';
        document.documentElement.style.setProperty('--accent', themeColor);
        // ì‚¬ì´ë“œë°” ì¹´í…Œê³ ë¦¬ ìƒ‰ìƒ ê°•ì œ ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•´ renderSidebar í˜¸ì¶œ
        renderSidebar(); 
    }
    
    function updateThemeColor(color) {
        novelThemes[currentNovelFilter] = color;
        localStorage.setItem('chunGakThemes_v9', JSON.stringify(novelThemes));
        applyTheme(color);
        renderPage(); // í˜ì´ì§€ ì „ì²´ë¥¼ ë‹¤ì‹œ ê·¸ë ¤ ìƒ‰ìƒ ì ìš© í™•ì •
    }

    function renderSidebar() {
        const menu = document.getElementById('sidebar-menu'); menu.innerHTML = '';
        const search = document.getElementById('search-input').value.toLowerCase();
        let filtered = currentNovelFilter === "all" ? wikiData : wikiData.filter(d => d.novel === currentNovelFilter);
        if(search) filtered = filtered.filter(d => d.title.toLowerCase().includes(search) || d.content.toLowerCase().includes(search));
        
        const sorted = [];
        categories.forEach((cat, typeIdx) => {
            const items = filtered.filter(d => d.type === typeIdx).sort((a, b) => (a.subCategory || "").localeCompare(b.subCategory || ""));
            sorted.push(...items.map(item => ({...item, origIdx: wikiData.indexOf(item)})));
        });

        categories.forEach((cat, typeIdx) => {
            const items = sorted.filter(d => d.type === typeIdx);
            if (items.length > 0) {
                const catDiv = document.createElement('div'); 
                catDiv.className = 'side-cat'; 
                catDiv.style.color = 'var(--accent)'; // ëª…ì‹œì  ìŠ¤íƒ€ì¼ ì§€ì •
                catDiv.innerText = cat; 
                menu.appendChild(catDiv);
                items.forEach((item) => {
                    const pNum = sorted.indexOf(item) + 3;
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'side-item' + (currentPage === pNum ? ' active' : '');
                    itemDiv.innerText = item.title; itemDiv.onclick = () => goToPage(pNum); menu.appendChild(itemDiv);
                });
            }
        });
        document.getElementById('last-update-display').innerText = "ë§ˆì§€ë§‰ ë³µì‚¬: " + lastUpdated;
    }

    function renderPage() {
        const sorted = [];
        const search = document.getElementById('search-input').value.toLowerCase();
        let filtered = currentNovelFilter === "all" ? wikiData : wikiData.filter(d => d.novel === currentNovelFilter);
        if(search) filtered = filtered.filter(d => d.title.toLowerCase().includes(search) || d.content.toLowerCase().includes(search));
        categories.forEach((cat, typeIdx) => {
            const items = filtered.filter(d => d.type === typeIdx).sort((a, b) => (a.subCategory || "").localeCompare(b.subCategory || ""));
            sorted.push(...items.map(item => ({...item, origIdx: wikiData.indexOf(item)})));
        });

        totalPages = sorted.length + 2;
        const container = document.getElementById('content'); const editable = isReader ? 'false' : 'true';
        document.getElementById('footer-page-num').innerText = `PAGE ${currentPage}`;
        
        const selector = document.getElementById('novel-filter');
        const novels = [...new Set(wikiData.map(d => d.novel))];
        selector.innerHTML = '<option value="all">ì „ì²´ ì‘í’ˆ ë³´ê¸°</option>';
        novels.forEach(n => { const opt = document.createElement('option'); opt.value = n; opt.innerText = n; opt.selected = (currentNovelFilter === n); selector.appendChild(opt); });

        if (currentPage === 1) {
            container.innerHTML = `<div class="wiki-card" style="display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center;"><div style="font-size:4rem; font-weight:800; letter-spacing:15px; color:var(--accent)">å¤© åˆ»</div><p style="margin-top:20px; color:var(--sub-text);">${currentNovelFilter === 'all' ? 'í†µí•© ë„ê°' : currentNovelFilter + ' ì„¤ì •ì§‘'}</p></div>`;
        } else if (currentPage === 2) {
            let tocHtml = `<div class="wiki-card"><h1>ëª©ì°¨</h1><div style="list-style:none; padding:0;">`;
            categories.forEach((cat, typeIdx) => {
                const items = sorted.filter(d => d.type === typeIdx);
                if (items.length > 0) {
                    tocHtml += `<div style="font-weight:800; font-size:1.1rem; margin-top:30px; border-bottom:1px solid var(--accent); color:var(--accent)">${cat}</div>`;
                    items.forEach((item) => { const pNum = sorted.indexOf(item) + 3; tocHtml += `<div style="display:flex; justify-content:space-between; margin:10px 0 0 20px; cursor:pointer;" onclick="goToPage(${pNum})">${item.title}<span>${pNum}</span></div>`; });
                }
            });
            tocHtml += `</div></div>`; container.innerHTML = tocHtml;
        } else {
            const item = sorted[currentPage - 3]; const isHighDanger = (item.danger >= 6);
            let specialLayout = '';
            if(item.type === 4) specialLayout = `<div style="padding:20px; background:var(--bg); border-radius:12px; margin-bottom:20px; border-left:10px solid var(--accent);"><div style="font-size:0.8rem; color:var(--accent); font-weight:800;">ëŒ€ìƒ â†” ê´€ê³„ â†” ëª©í‘œ</div><div style="font-size:1.5rem; font-weight:800; margin-top:10px;" contenteditable="${editable}" oninput="liveUpdate(${item.origIdx}, 'habitat', this.innerText)">${item.habitat || ''}</div></div>`;
            else if(item.type === 5) specialLayout = `<div style="padding:15px; background:var(--bg); border-radius:8px; margin-bottom:20px;"><span style="font-weight:800; color:var(--accent);">ì‹œê¸°: </span><span contenteditable="${editable}" oninput="liveUpdate(${item.origIdx}, 'habitat', this.innerText)">${item.habitat || ''}</span></div>`;

            container.innerHTML = `<div class="wiki-card ${isHighDanger ? 'high-danger' : ''}">
                <div style="margin-bottom:20px; font-size:0.8rem; color:var(--sub-text);"><span class="edit-only">ì†Œì„¤: </span><span contenteditable="${editable}" oninput="liveUpdate(${item.origIdx}, 'novel', this.innerText)">${item.novel || ''}</span><span style="margin-left:15px;">ë¶„ë¥˜: ${categories[item.type]}</span><span class="edit-only" style="margin-left:15px;">ì†Œë¶„ë¥˜: </span><span contenteditable="${editable}" oninput="liveUpdate(${item.origIdx}, 'subCategory', this.innerText)">${item.subCategory || ''}</span></div>
                <h1 contenteditable="${editable}" oninput="liveUpdate(${item.origIdx}, 'title', this.innerText); renderSidebar();">${item.title}</h1>
                <div class="danger-zone" onclick="${isReader ? '' : `updateDanger(${item.origIdx})`}">ìœ„í—˜ë„ ${'â˜…'.repeat(item.danger || 0)}${'â˜†'.repeat(10 - (item.danger || 0))}</div>
                ${specialLayout}
                ${item.type < 4 ? `<div class="info-grid"><div class="info-box"><span class="info-label">ìƒíƒœ / ë°°ê²½</span><div class="info-val" contenteditable="${editable}" oninput="liveUpdate(${item.origIdx}, 'habitat', this.innerText)">${item.habitat || ''}</div></div><div class="info-box"><span class="info-label">ì•½ì  / íŠ¹ì§•</span><div class="info-val" contenteditable="${editable}" oninput="liveUpdate(${item.origIdx}, 'weakness', this.innerText)">${item.weakness || ''}</div></div></div>` : ''}
                <div class="editable-area" contenteditable="${editable}" oninput="liveUpdate(${item.origIdx}, 'content', this.innerText)">${item.content}</div>
                <div class="author-note"><div style="margin-top:10px;" contenteditable="${editable}" oninput="liveUpdate(${item.origIdx}, 'authorMemo', this.innerText)">${item.authorMemo || ''}</div></div>
                <button class="btn-delete" style="margin-top:40px; border:1px solid #ff3b30; color:#ff3b30; background:none; padding:8px; border-radius:8px; cursor:pointer;" onclick="deleteItem(${item.origIdx})">í•­ëª© ì‚­ì œ</button>
            </div>`;
        }
        renderSidebar();
    }
    
    function changeNovel(val) { 
        currentNovelFilter = val; 
        applyTheme(novelThemes[val] || '#1d1d1f'); 
        currentPage = 2; 
        renderPage(); 
    }
    
    function liveUpdate(idx, field, val) { wikiData[idx][field] = val; localStorage.setItem('chunGakData_v9', JSON.stringify(wikiData)); }
    function goToPage(n) { if (n >= 1 && n <= totalPages) { currentPage = n; renderPage(); } }
    function nextPage() { goToPage(currentPage + 1); }
    function prevPage() { goToPage(currentPage - 1); }
    function jumpToPage() { const val = parseInt(document.getElementById('jump-page-input').value); if (val) goToPage(val); }
    function updateDanger(idx) { const val = prompt("ìœ„í—˜ë„ (1-10)", wikiData[idx].danger || 1); const num = parseInt(val); if(!isNaN(num) && num >= 1 && num <= 10) { wikiData[idx].danger = num; localStorage.setItem('chunGakData_v9', JSON.stringify(wikiData)); renderPage(); } }
    
    function addNewItem() {
        const typeStr = prompt("0:ì„¸ê³„ê´€, 1:ìºë¦­í„°, 2:ëª¬ìŠ¤í„°, 3:ì§œíˆ¬ë¦¬, 4:ê´€ê³„ë„, 5:ì—°ëŒ€ê¸°", "3"); if(typeStr === null) return;
        const novelName = currentNovelFilter === "all" ? prompt("ì†Œì„¤ ì œëª©", "ìƒˆ ì‘í’ˆ") : currentNovelFilter;
        wikiData.push({ novel: novelName, type: parseInt(typeStr), subCategory: "ë¯¸ë¶„ë¥˜", title: "ìƒˆ í•­ëª©", content: "ë‚´ìš© ì…ë ¥", danger: 1, habitat: "", weakness: "", authorMemo: "" });
        localStorage.setItem('chunGakData_v9', JSON.stringify(wikiData));
        if(!novelThemes[novelName]) novelThemes[novelName] = "#1d1d1f"; 
        localStorage.setItem('chunGakThemes_v9', JSON.stringify(novelThemes));
        currentNovelFilter = novelName; changeNovel(novelName);
    }
    
    function exportData() {
        const exportObj = { data: wikiData, themes: novelThemes, lastUpdated: new Date().toLocaleString() };
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(exportObj, null, 4));
        const downloadAnchorNode = document.createElement('a');
        downloadAnchorNode.setAttribute("href", dataStr);
        downloadAnchorNode.setAttribute("download", "ì²œê°_ë„ê°_ë°±ì—…_" + new Date().toLocaleDateString() + ".json");
        document.body.appendChild(downloadAnchorNode); downloadAnchorNode.click(); downloadAnchorNode.remove();
        alert("ë°±ì—… íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!");
    }

    function copyFullCode() {
        lastUpdated = new Date().toLocaleString();
        localStorage.setItem('chunGakTime', lastUpdated);
        let fullHtml = document.documentElement.outerHTML;
        fullHtml = fullHtml.replace(/let wikiData = \[[\s\S]*?\];/, `let wikiData = ${JSON.stringify(wikiData, null, 4)};`);
        fullHtml = fullHtml.replace(/let novelThemes = \{[\s\S]*?\};/, `let novelThemes = ${JSON.stringify(novelThemes, null, 4)};`);
        fullHtml = fullHtml.replace(/let lastUpdated = ".*?";/, `let lastUpdated = "${lastUpdated}";`);
        navigator.clipboard.writeText(fullHtml).then(() => alert("ì „ì²´ ì†ŒìŠ¤ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\n(ê¸°ë¡ ì‹œê°„: " + lastUpdated + ")"));
    }
    function copyReaderLink() { navigator.clipboard.writeText("https://sasayus.github.io/library/?mode=read").then(() => alert("ë…ì ë§í¬ ë³µì‚¬ ì™„ë£Œ!")); }
    function deleteItem(idx) { if(confirm("ì‚­ì œí• ê¹Œìš”?")) { wikiData.splice(idx, 1); localStorage.setItem('chunGakData_v9', JSON.stringify(wikiData)); currentPage = 2; renderPage(); } }
    
    // ì´ˆê¸° í…Œë§ˆ ì ìš©
    applyTheme(novelThemes[currentNovelFilter]); 
    renderPage();
</script>

</body></html>
